# ğŸ¤– AiFoodApp

## ğŸ“ DescriÃ§Ã£o

O AiFoodApp Ã© uma aplicaÃ§Ã£o Java Spring Boot que demonstra a integraÃ§Ã£o de um back-end com mÃºltiplas APIs de geraÃ§Ã£o de texto, incluindo a API da Maritalk e OpenAI, para gerar receitas e outras informaÃ§Ãµes. AlÃ©m disso, a aplicaÃ§Ã£o gerencia itens alimentares utilizando um banco de dados H2. O projeto segue o padrÃ£o de arquitetura MVC para melhor organizaÃ§Ã£o e escalabilidade.

## âœ¨ Funcionalidades

### ğŸŒŸ Gerenciamento de Itens Alimentares

- CriaÃ§Ã£o, listagem, atualizaÃ§Ã£o e exclusÃ£o de itens alimentares via API REST.
- PersistÃªncia de dados em banco de dados H2.

### ğŸŒŸ GeraÃ§Ã£o de Receitas e ConteÃºdo

- IntegraÃ§Ã£o com APIs externas (Maritalk e OpenAI) para gerar receitas e outros tipos de conteÃºdo baseados em texto.
- UtilizaÃ§Ã£o de WebClient para comunicaÃ§Ã£o com as APIs externas.
- UtilizaÃ§Ã£o do mesmo padrÃ£o de requisiÃ§Ã£o para ambas as APIs.

### ğŸŒŸ ConfiguraÃ§Ã£o de Ambiente FlexÃ­vel

- Gerenciamento de variÃ¡veis de ambiente com Dotenv, facilitando a troca de URLs, chaves de API e modelos.
- ConfiguraÃ§Ã£o centralizada do WebClient para chamadas Ã s APIs externas.
- Facilidade de troca de modelo e API devido ao uso do mesmo padrÃ£o de requisiÃ§Ã£o.

## ğŸ› ï¸ Tecnologias Utilizadas

- **Java**: Linguagem de programaÃ§Ã£o principal.
- **Spring Boot**: Framework para desenvolvimento rÃ¡pido de aplicaÃ§Ãµes Java.
- **Spring WebFlux**: Framework reativo para construÃ§Ã£o de aplicaÃ§Ãµes web escalÃ¡veis.
- **H2 Database**: Banco de dados em memÃ³ria para desenvolvimento e testes.
- **Flyway**: Gerenciamento de migraÃ§Ãµes de banco de dados.
- **Lombok**: GeraÃ§Ã£o automÃ¡tica de cÃ³digo boilerplate.
- **Dotenv**: Gerenciamento de variÃ¡veis de ambiente.
- **Maven**: Gerenciamento de dependÃªncias e build.

## ğŸ“‚ PersistÃªncia de Dados no H2

O projeto utiliza o banco de dados H2 para armazenar os dados e foi configurado para armazenamento persistente em arquivo. No entanto, por padrÃ£o, o H2 nÃ£o persiste os dados entre reinicializaÃ§Ãµes. Veja abaixo como configurar corretamente.

### Como acessar o console do H2

1. **Inicie a aplicaÃ§Ã£o**
   ```
   ./mvnw spring-boot:run
   ```

2. **Acesse o console web do H2**
  - Abra um navegador e acesse: http://localhost:8080/h2-console

3. **Configurar a conexÃ£o**
  - Use as seguintes credenciais:
    - **JDBC URL**: `jdbc:h2:mem:testdb`
    - **User Name**: `sa`
    - **Password**: (deixe em branco)

4. **Executar consultas**
   ```sql
   SELECT * FROM FOOD_ITEM;
   ```

### Tornando os dados persistentes

Para manter os dados apÃ³s reinicializaÃ§Ã£o, altere o arquivo `application.properties`:

```properties
spring.datasource.url=jdbc:h2:file:./data/aitestapp
spring.datasource.driverClassName=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect
spring.h2.console.enabled=true
```

## ğŸ—„ï¸ MigraÃ§Ãµes de Banco de Dados com Flyway

O projeto utiliza Flyway para gerenciamento de migraÃ§Ãµes de banco de dados, garantindo que o esquema seja consistente em todos os ambientes.

### Estrutura das MigraÃ§Ãµes

As migraÃ§Ãµes estÃ£o localizadas em:
```
src/
â””â”€â”€ main/
    â””â”€â”€ resources/
        â””â”€â”€ db/
            â””â”€â”€ migration/
                â”œâ”€â”€ V1__create_food_item_table.sql
                â”œâ”€â”€ V2__add_nutrition_columns.sql
                â””â”€â”€ ...
```

### Executando MigraÃ§Ãµes

As migraÃ§Ãµes sÃ£o executadas automaticamente na inicializaÃ§Ã£o da aplicaÃ§Ã£o. Para executÃ¡-las manualmente:

```bash
./mvnw flyway:migrate
```

### Criando Novas MigraÃ§Ãµes

Para adicionar uma nova migraÃ§Ã£o:

1. Crie um novo arquivo SQL na pasta `src/main/resources/db/migration/`
2. Nomeie o arquivo seguindo o padrÃ£o: `V{nÃºmero}__{descriÃ§Ã£o}.sql`
3. Escreva as instruÃ§Ãµes SQL necessÃ¡rias
4. Ao reiniciar a aplicaÃ§Ã£o, o Flyway aplicarÃ¡ automaticamente as novas migraÃ§Ãµes

## ğŸ“ Estrutura do Projeto

```
src/
â”œâ”€â”€ main/
â”‚   â”œâ”€â”€ java/
â”‚   â”‚   â””â”€â”€ com/example/aitestapp/
â”‚   â”‚       â”œâ”€â”€ AiTestAppApplication.java
â”‚   â”‚       â”œâ”€â”€ controller/
â”‚   â”‚       â”‚   â”œâ”€â”€ FoodItemController.java
â”‚   â”‚       â”‚   â””â”€â”€ RecipeController.java
â”‚   â”‚       â”œâ”€â”€ service/
â”‚   â”‚           â”œâ”€â”€ FoodItemService.java
â”‚   â”‚           â””â”€â”€ TextGenService.java
â”‚   â””â”€â”€ resources/
â”‚       â”œâ”€â”€ application.properties
â”‚       â””â”€â”€ db/
â”‚           â””â”€â”€ migration/
â”‚               â””â”€â”€ V1__create_food_item_table.sql
â””â”€â”€ test/
    â””â”€â”€ java/
        â””â”€â”€ com/example/aitestapp/
            â””â”€â”€ AiTestAppApplicationTests.java
```

## ğŸ’» InstalaÃ§Ã£o

### PrÃ©-requisitos:

- Java JDK 11 ou superior.
- Maven.
- Git.

### ConfiguraÃ§Ã£o e InstalaÃ§Ã£o:

1. **Clone o repositÃ³rio**:
   ```bash
   git clone https://github.com/OtavioXimarelli/AiAPP.git
   cd AiTestApp
   ```

2. **Configure as variÃ¡veis de ambiente no arquivo `.env`**:
   ```
   MARITALK_URL=url_da_maritalk
   MARITAL_KEY=sua_api_key_aqui
   MARI_MODEL=seu_modelo_aqui
   GPT_URL=url_da_openai
   GPT_MODEL=seu_modelo_aqui
   OPEN_AI_KEY=sua_open_ai_key_aqui
   ```

3. **Execute a aplicaÃ§Ã£o**:
   ```bash
   ./mvnw spring-boot:run
   ```

## ğŸ“š Uso

Acesse a aplicaÃ§Ã£o em http://localhost:8080/.

Utilize os endpoints abaixo para gerenciar itens alimentares e gerar receitas.

### Endpoints da API

#### GeraÃ§Ã£o de Receitas

- **Gerar Receita**
  - GET `/gen` - Retorna uma receita gerada por API externa.

  - **Atualmente o serviÃ§o de geraÃ§Ã£o de receita com base nos itens salvos no banco de dado estÃ¡ em desenvolvimento :)**

#### Gerenciamento de Itens Alimentares

- **Criar item** (POST `/food/create`)
- **Listar todos os itens** (GET `/food/list`)
- **Listar item por ID** (GET `/food/list/{id}`)
- **Atualizar item** (PUT `/food/update`)

## ğŸ‘¥ ContribuiÃ§Ãµes

ContribuiÃ§Ãµes sÃ£o bem-vindas! Abra um pull request ou relate problemas.

## âœ‰ï¸ LicenÃ§a

Este projeto estÃ¡ licenciado sob a MIT License. 