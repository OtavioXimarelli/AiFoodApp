# AI Food App

[![Spring Boot](https://img.shields.io/badge/Spring%20Boot-3.5.4-brightgreen)](https://spring.io/projects/spring-boot)
[![Java](https://img.shields.io/badge/Java-23-orange)](https://oracle.com/java/)
[![Spring AI](https://img.shields.io/badge/Spring%20AI-0.8.0-blue)](https://spring.io/projects/spring-ai)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-15-blue)](https://www.postgresql.org/)
[![Flyway](https://img.shields.io/badge/Flyway-Latest-red)](https://flywaydb.org/)
[![Docker](https://img.shields.io/badge/Docker-Latest-2496ED)](https://www.docker.com/)
[![Docker Compose](https://img.shields.io/badge/Docker%20Compose-3.8-2496ED)](https://docs.docker.com/compose/)
[![OAuth2](https://img.shields.io/badge/OAuth2-Google-4285F4)](https://developers.google.com/identity/protocols/oauth2)

---

## üìù Sobre o Projeto

O **AI Food App** integra o gerenciamento inteligente de alimentos com IA para gerar receitas personalizadas e an√°lises nutricionais. A autentica√ß√£o √© feita via Google OAuth2, garantindo seguran√ßa e praticidade.

---

## üìã Sum√°rio

- [Fluxo de Autentica√ß√£o](#fluxo-de-autentica√ß√£o)
- [Solu√ß√£o de Problemas](#solu√ß√£o-de-problemas)
- [Tecnologias Utilizadas](#tecnologias-utilizadas)
- [Arquitetura](#arquitetura)
- [Seguran√ßa e Autentica√ß√£o](#seguran√ßa-e-autentica√ß√£o)
- [Banco de Dados](#estrutura-do-banco-de-dados)
- [Implanta√ß√£o](#arquitetura-de-implanta√ß√£o)
- [Funcionalidades](#funcionalidades)
- [API Endpoints](#api-endpoints)
- [Como Executar](#como-executar-o-projeto)
- [Status Atual](#status-atual-do-projeto)
- [Pr√≥ximos Passos](#pr√≥ximos-passos)
- [Contribui√ß√µes](#contribui√ß√µes)
- [Licen√ßa](#licen√ßa)

---

## üîê Fluxo de Autentica√ß√£o

1. **Iniciar Login**
   - Usu√°rio clica no bot√£o de login com Google.
   - Frontend redireciona para `/oauth2/authorization/google`.
   - Spring Security processa e redireciona para login do Google.

2. **Autoriza√ß√£o Google**
   - Usu√°rio autentica no Google.
   - Google retorna para `/login/oauth2/code/google` com o c√≥digo.

3. **Processamento**
   - Spring Security processa o c√≥digo, cria sess√£o e define o cookie `JSESSIONID`.
   - Usu√°rio √© redirecionado para a p√°gina inicial.

4. **Verifica√ß√£o**
   - Frontend consulta `/api/auth/status`.
   - Se autenticado, busca dados do usu√°rio em `/api/auth`.

---

## üõ†Ô∏è Tecnologias Utilizadas

- **Spring Boot 3.5.4**: Backend Java
- **Spring Data JPA**: Persist√™ncia
- **Spring AI**: Integra√ß√£o IA
- **Maritaca AI**: API de receitas e nutri√ß√£o
- **Spring Security & OAuth2**: Autentica√ß√£o Google
- **Spring Session JDBC**: Sess√µes persistentes
- **PostgreSQL 15**: Banco relacional
- **Flyway**: Versionamento do banco
- **Lombok**: Menos boilerplate
- **RESTful API**: Integra√ß√£o backend
- **Docker & Docker Compose**: Containers e orquestra√ß√£o
- **Nginx**: Proxy reverso e SSL
- **AWS EC2**: Hospedagem

---

## üèóÔ∏è Arquitetura

- **Controller**: Endpoints REST
- **Service**: L√≥gica de neg√≥cio
- **Repository**: Acesso a dados
- **Model**: Entidades do dom√≠nio
- **DTO & Mapper**: Transfer√™ncia e convers√£o de dados
- **Config & Security**: Configura√ß√µes gerais e autentica√ß√£o
- **Filter**: Processamento de requisi√ß√µes (paths, rate limiting, diagn√≥sticos)

---

## üîí Seguran√ßa e Autentica√ß√£o

- **OAuth2 Google**: Login seguro, sem senha
- **Spring Session JDBC**: Sess√µes no banco
- **Cookie Seguro**: Configura√ß√£o avan√ßada (`secure`, `SameSite`, `domain`)
- **Rate Limiting**: Prote√ß√£o contra brute force
- **Diagn√≥stico**: Monitoramento do fluxo de autentica√ß√£o

### Exemplo de configura√ß√£o (`application.yaml`)

```yaml
spring:
  security:
    oauth2:
      client:
        registration:
          google:
            client-id: ${GOOGLE_CLIENT_ID}
            client-secret: ${GOOGLE_CLIENT_SECRET}
            scope:
              - openid
              - profile
              - email
  session:
    store-type: jdbc
    jdbc:
      initialize-schema: never
    timeout: 2592000  # 30 dias
    cookie:
      secure: ${COOKIE_SECURE:true}
      same-site: ${COOKIE_SAME_SITE:lax}
      domain: ${COOKIE_DOMAIN:.aifoodapp.site}
```

---

## üóÉÔ∏è Estrutura do Banco de Dados

- `tb_food_item`: Alimentos e informa√ß√µes nutricionais
- `tb_recipes`: Receitas geradas
- `tb_recipe_instructions`: Passos das receitas
- `tb_recipes_nutritional_info`: Nutri√ß√£o das receitas
- `tb_recipe_ingredients`: Ingredientes de receitas
- `tb_users`: Usu√°rios (OAuth2 e perfil)
- `spring_session`: Sess√µes persistidas

---

## üåê Arquitetura de Implanta√ß√£o

- **Frontend**: Site est√°tico servido pelo Nginx
- **Backend**: Spring Boot em container Docker
- **Banco de Dados**: PostgreSQL em container Docker
- **Nginx**: Proxy reverso, SSL e API gateway
- **Docker Compose**: Orquestra√ß√£o de todos os servi√ßos
- **AWS EC2**: Infraestrutura de hospedagem

---

## üöÄ Funcionalidades

### Autentica√ß√£o Social
- Login com Google OAuth2
- Sess√µes persistentes (30 dias)
- Redirecionamentos seguros

### Gerenciamento de Alimentos
- CRUD completo
- Categoriza√ß√£o e nutri√ß√£o

### Gera√ß√£o de Receitas IA
- Receitas autom√°ticas baseadas nos alimentos do usu√°rio
- Instru√ß√µes detalhadas
- Nutri√ß√£o estimada

### An√°lise Nutricional
- Perfil nutricional das receitas
- Recomenda√ß√µes baseadas em necessidades diet√©ticas

---

## üîå API Endpoints

### Autentica√ß√£o e Usu√°rio
- `GET /oauth2/authorization/google` ‚Äî Inicia login Google OAuth2
- `GET /login/oauth2/code/google` ‚Äî Callback de autentica√ß√£o
- `GET /api/auth/status` ‚Äî Status de autentica√ß√£o
- `GET /api/auth` ‚Äî Dados do usu√°rio autenticado
- `POST /api/auth/logout` ‚Äî Logout

### Alimentos
- `POST /api/foods/create` ‚Äî Criar alimento
- `GET /api/foods/list` ‚Äî Listar alimentos
- `GET /api/foods/list/{id}` ‚Äî Buscar alimento por ID
- `PUT /api/foods/update` ‚Äî Atualizar alimento
- `DELETE /api/foods/delete/{id}` ‚Äî Remover alimento

### Receitas
- `GET /api/recipes/gen` ‚Äî Gerar receita com IA
- `GET /api/recipes/analyze/{id}` ‚Äî Analisar nutri√ß√£o da receita
- `GET /api/recipes/user` ‚Äî Listar receitas do usu√°rio

---

## üíª Como Executar o Projeto

### Execu√ß√£o Local

1. Clone o reposit√≥rio:
   ```bash
   git clone https://github.com/OtavioXimarelli/AiFoodApp.git
   cd AiFoodApp
   ```

2. Crie um arquivo `.env` na raiz com as vari√°veis necess√°rias.

3. Execute com Docker Compose:
   ```bash
   docker-compose up -d
   ```

### Implanta√ß√£o em Produ√ß√£o (AWS EC2)

1. Configure as credenciais AWS e acesso SSH √† sua inst√¢ncia EC2.

2. Fa√ßa o upload dos arquivos do projeto e das vari√°veis de ambiente para a inst√¢ncia.

3. Execute os containers Docker na EC2 normalmente:
   ```bash
   docker-compose up -d
   ```

---

## üß™ Status Atual do Projeto

- ‚úÖ Estrutura completa
- ‚úÖ Autentica√ß√£o Google OAuth2
- ‚úÖ Sess√µes persistentes
- ‚úÖ Gerenciamento de alimentos (CRUD)
- ‚úÖ Integra√ß√£o Maritaca AI
- ‚úÖ Gera√ß√£o de receitas IA
- ‚úÖ An√°lise nutricional
- ‚úÖ Deploy automatizado AWS EC2
- ‚úÖ HTTPS via Nginx

---

## üìã Pr√≥ximos Passos

- [ ] Melhorias na interface do usu√°rio
- [ ] Recomenda√ß√µes personalizadas por perfil
- [ ] Sistema de favoritos/hist√≥rico
- [ ] Integra√ß√£o com m√∫ltiplos provedores de IA
- [ ] CI/CD e monitoramento aprimorados

---

## üõ†Ô∏è Solu√ß√£o de Problemas

### Autentica√ß√£o

- **404 em `/oauth2/authorization/google`**: Verifique configura√ß√£o do Nginx.
- **Cookies n√£o persistentes**: Veja `SameSite` e dom√≠nio dos cookies.
- **401 Unauthorized**: Verifique logs para sess√£o/token.
- **Redirecionamentos Infinitos**: Revise configura√ß√£o do proxy Nginx.

### Comandos √öteis

- Ver logs do backend: `docker logs aifoodapp`
- Testar configura√ß√£o do Nginx: `sudo nginx -t`
- Aplicar nova config Nginx: `./update_nginx.sh`
- Reiniciar servi√ßos: `docker-compose restart`

---

## üë• Contribui√ß√µes

Contribui√ß√µes s√£o bem-vindas! Abra issues e pull requests para melhorias.

---

## üìÑ Licen√ßa

Este projeto est√° licenciado sob a [MIT License](LICENSE).
