# AI Food App

[![Spring Boot](https://img.shields.io/badge/Spring%20Boot-3.5.4-brightgreen)](https://spring.io/projects/spring-boot)
[![Java](https://img.shields.io/badge/Java-23-orange)](http## üîê Fluxo de Autentica√ß√£o

1. **Iniciar Login**:
   - Usu√°rio clica no bot√£o de login com Google
   - O frontend redireciona para `/oauth2/authorization/google`
   - Spring Security processa a requisi√ß√£o e redireciona para tela de login do Google

2. **Autoriza√ß√£o Google**:
   - Usu√°rio se autentica no Google
   - Google redireciona de volta para `/login/oauth2/code/google` com o c√≥digo de autoriza√ß√£o

3. **Processamento pela Aplica√ß√£o**:
   - Spring Security processa o c√≥digo e cria uma sess√£o
   - Cookies JSESSIONID s√£o configurados
   - Usu√°rio √© redirecionado para a p√°gina inicial

4. **Verifica√ß√£o de Autentica√ß√£o**:
   - O frontend verifica o status com `/api/auth/status`
   - Se autenticado, busca os dados do usu√°rio com `/api/auth`

## üîß Solu√ß√£o de Problemas

### Problemas Comuns de Autentica√ß√£o
- **404 em /oauth2/authorization/google**: Verifique a configura√ß√£o do Nginx para este path
- **Cookies N√£o Persistentes**: Verifique as configura√ß√µes de SameSite e Dom√≠nio nos cookies
- **401 Unauthorized**: Verifique os logs para problemas de sess√£o ou token
- **Redirecionamentos Infinitos**: Problemas na configura√ß√£o do proxy Nginx

### Comandos √öteis
- Verificar logs do backend: `docker logs aifoodapp`
- Testar configura√ß√£o Nginx: `sudo nginx -t`
- Aplicar nova configura√ß√£o Nginx: `./update_nginx.sh`
- Reiniciar servi√ßos: `docker-compose restart`cle.com/java/)
[![Spring AI](https://img.shields.io/badge/Spring%20AI-0.8.0-blue)](https://spring.io/projects/spring-ai)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-15-blue)](https://www.postgresql.org/)
[![Flyway](https://img.shields.io/badge/Flyway-Latest-red)](https://flywaydb.org/)
[![Docker](https://img.shields.io/badge/Docker-Latest-2496ED)](https://www.docker.com/)
[![Docker Compose](https://img.shields.io/badge/Docker%20Compose-3.8-2496ED)](https://docs.docker.com/compose/)
[![OAuth2](https://img.shields.io/badge/OAuth2-Google-4285F4)](https://developers.google.com/identity/protocols/oauth2)


## üìù Sobre o Projeto

O AI Food App integra gerenciamento de alimentos com intelig√™ncia artificial para gerar receitas personalizadas e an√°lises nutricionais. O sistema conta com autentica√ß√£o de usu√°rios via Google OAuth2, persist√™ncia de sess√µes, e seguran√ßa refor√ßada via Spring Security, tudo implantado em um ambiente AWS EC2 com HTTPS.

## üõ†Ô∏è Tecnologias Utilizadas

- **Spring Boot 3.5.4**: Framework para aplica√ß√µes Java
- **Spring Data JPA**: Persist√™ncia de dados
- **Spring AI**: Integra√ß√£o com APIs de IA
- **Maritaca AI**: API de IA para receitas e nutri√ß√£o
- **Spring Security & OAuth2**: Autentica√ß√£o e autoriza√ß√£o (Google)
- **Spring Session JDBC**: Persist√™ncia de sess√µes
- **PostgreSQL 15**: Banco de dados relacional
- **Flyway**: Controle de vers√£o do banco
- **Lombok**: Redu√ß√£o de boilerplate
- **RESTful API**: Comunica√ß√£o backend
- **Docker**: Containeriza√ß√£o
- **Docker Compose**: Orquestra√ß√£o de containers
- **Nginx**: Proxy reverso e SSL
- **AWS EC2**: Hospedagem em nuvem

## üèóÔ∏è Arquitetura

- **Controller**: Endpoints REST e gerenciamento de requisi√ß√µes
- **Service**: L√≥gica de neg√≥cio e integra√ß√£o com servi√ßos externos
- **Repository**: Acesso a dados
- **Model**: Entidades do dom√≠nio
- **DTO**: Transfer√™ncia de dados
- **Mapper**: Convers√£o entre entidades e DTOs
- **Config**: Configura√ß√µes da aplica√ß√£o
- **Security**: Autentica√ß√£o OAuth2, gerenciamento de sess√µes
- **Filter**: Processamento de requisi√ß√µes (corre√ß√£o de caminhos, limita√ß√£o de taxa, diagn√≥sticos)

## üîí Seguran√ßa e Autentica√ß√£o

- **OAuth2 com Google**: Login social sem necessidade de senhas
- **Spring Session JDBC**: Persist√™ncia de sess√µes no banco de dados
- **Cookie Seguro**: Configura√ß√£o avan√ßada de cookies com secure, SameSite e dom√≠nio
- **Rate Limiting**: Prote√ß√£o contra ataques de for√ßa bruta
- **Diagn√≥sticos de Autentica√ß√£o**: Monitoramento e depura√ß√£o do fluxo de autentica√ß√£o

### Principais Configura√ß√µes

```yaml
# Configura√ß√£o do Google OAuth2
spring:
  security:
    oauth2:
      client:
        registration:
          google:
            client-id: ${GOOGLE_CLIENT_ID}
            client-secret: ${GOOGLE_CLIENT_SECRET}
            scope:
              - openid
              - profile
              - email

# Configura√ß√£o de Sess√µes e Cookies
  session:
    store-type: jdbc
    jdbc:
      initialize-schema: never
    timeout: 2592000  # 30 dias
    cookie:
      secure: ${COOKIE_SECURE:true}
      same-site: ${COOKIE_SAME_SITE:lax}
      domain: ${COOKIE_DOMAIN:.aifoodapp.site}
```

## üóÉÔ∏è Estrutura do Banco de Dados

- **tb_food_item**: Alimentos e informa√ß√µes nutricionais
- **tb_recipes**: Receitas geradas
- **tb_recipe_instructions**: Passos das receitas
- **tb_recipes_nutritional_info**: Informa√ß√µes nutricionais das receitas
- **tb_recipe_ingredients**: Ingredientes das receitas
- **tb_users**: Usu√°rios (OAuth2 e informa√ß√µes de perfil)
- **spring_session**: Tabelas de persist√™ncia de sess√£o

## üåê Arquitetura de Implanta√ß√£o

- **Frontend**: Site est√°tico servido pelo Nginx
- **Backend**: Aplica√ß√£o Spring Boot em container Docker
- **Banco de Dados**: PostgreSQL em container Docker
- **Nginx**: Proxy reverso, SSL e roteamento de API
- **Docker Compose**: Orquestra√ß√£o de todos os servi√ßos
- **AWS EC2**: Infraestrutura de hospedagem

## üöÄ Funcionalidades

### Autentica√ß√£o Social
- Login com Google OAuth2
- Persist√™ncia de sess√µes por 30 dias
- Fluxo de autentica√ß√£o seguro com redirecionamentos

### Gerenciamento de Alimentos
- CRUD completo de alimentos
- Categoriza√ß√£o e informa√ß√µes nutricionais

### Gera√ß√£o de Receitas com IA
- Cria√ß√£o autom√°tica de receitas baseadas nos alimentos dispon√≠veis
- Instru√ß√µes detalhadas passo a passo
- Informa√ß√µes nutricionais estimadas

### An√°lise Nutricional
- An√°lise do perfil nutricional das receitas
- Recomenda√ß√µes baseadas em necessidades diet√©ticas

## üîå API Endpoints

### Autentica√ß√£o e Usu√°rio
- `GET /oauth2/authorization/google`: Inicia o processo de login com Google OAuth2
- `GET /login/oauth2/code/google`: Callback ap√≥s autentica√ß√£o com Google
- `GET /api/auth/status`: Verifica status de autentica√ß√£o
- `GET /api/auth`: Retorna informa√ß√µes do usu√°rio autenticado
- `POST /api/auth/logout`: Encerra a sess√£o do usu√°rio

### Alimentos (Food Items)
- `POST /api/foods/create`: Cria alimento
- `GET /api/foods/list`: Lista alimentos
- `GET /api/foods/list/{id}`: Busca alimento por ID
- `PUT /api/foods/update`: Atualiza alimento
- `DELETE /api/foods/delete/{id}`: Remove alimento

### Receitas (Recipes)
- `GET /api/recipes/gen`: Gera receita com IA
- `GET /api/recipes/analyze/{id}`: Analisa nutri√ß√£o da receita
- `GET /api/recipes/user`: Lista receitas do usu√°rio

## üíª Como Executar o Projeto

### Execu√ß√£o Local

1. Clone o reposit√≥rio
   ```bash
   git clone https://github.com/OtavioXimarelli/AiFoodApp.git
   cd AiFoodApp
   ```

2. Crie um arquivo `.env` na raiz do projeto com as vari√°veis necess√°rias

3. Execute com Docker Compose
   ```bash
   docker-compose up -d
   ```

### Implanta√ß√£o em Produ√ß√£o (AWS EC2)

1. Configure suas credenciais AWS e acesso SSH

2. Execute o script de implanta√ß√£o
   ```bash
   ./deploy.sh --auto
   ```

3. Para atualizar apenas a configura√ß√£o do Nginx
   ```bash
   ./update_nginx.sh
   ```

## üß™ Status Atual do Projeto

- ‚úÖ Estrutura completa da aplica√ß√£o
- ‚úÖ Autentica√ß√£o OAuth2 com Google
- ‚úÖ Persist√™ncia de sess√µes
- ‚úÖ Gerenciamento de alimentos (CRUD)
- ‚úÖ Integra√ß√£o com Maritaca AI
- ‚úÖ Gera√ß√£o de receitas com IA
- ‚úÖ An√°lise nutricional
- ‚úÖ Implanta√ß√£o automatizada em AWS EC2
- ‚úÖ Configura√ß√£o HTTPS com Nginx

## üìã Pr√≥ximos Passos

- üî≤ Melhorias na interface do usu√°rio
- üî≤ Recomenda√ß√µes personalizadas por perfil
- üî≤ Sistema de favoritos/hist√≥rico
- üî≤ Integra√ß√£o com m√∫ltiplos provedores de IA
- üî≤ CI/CD e monitoramento aprimorado

## ÔøΩ Solu√ß√£o de Problemas

### Problemas Comuns de Autentica√ß√£o
- **Cookies N√£o Persistentes**: Verifique as configura√ß√µes de SameSite e Dom√≠nio nos cookies
- **401 Unauthorized**: Verifique os logs para problemas de sess√£o ou token
- **Redirecionamentos Infinitos**: Problemas na configura√ß√£o do proxy Nginx

### Comandos √öteis
- Verificar logs do backend: `docker logs aifoodapp`
- Testar configura√ß√£o Nginx: `sudo nginx -t`
- Reiniciar servi√ßos: `docker-compose restart`

## üë• Contribui√ß√µes

Contribui√ß√µes s√£o bem-vindas! Abra issues e pull requests para melhorar o projeto.

## üìÑ Licen√ßa

Este projeto est√° licenciado sob a [MIT License](LICENSE).
